# Тестовое задание Perfect Panel

## Содержание

- [Структура и описание проекта](#project_description)
- [Роль composer](#role_composer)
- [Роль mysql](#role_mysql)
- [Роль nginx](#role_nginx)
- [Роль python](#role_python)
- [Роль system](#role_system)
- [Запуск ролей и плейбука](#start_role)
## <a name="project_description"></a>Структура и описание проекта
Данный проект представляет выполненное тестовое задание для Perfect Panel. В рамках тестового задания были реализованы Ansible роли и проведено тестирование корректности их работы.

Перед тем как работать с данным репозиторем - рекомендуется установить локально все необходимые пакеты Ansible. В противном случае, при использовании ролей могут возникнуть ошибки.

**Структура проекта:**
- ```roles/``` -  директория с ролями Ansible
- ```roles/composer``` - роль для установки Composer
- ```roles/mysql``` - роль для установки mysql
- ```roles/nginx``` - роль для установки nginx
- ```roles/python``` - роль для сборки и установки python
- ```roles/system``` - роль для настройки системных параметров (создание пользователя, настройка sysctl)
- ```inventory/``` - инвентори Ansible
- ```ansible.cfg``` - настройки для работы Ansible
- ```requirements.yml``` - зависимости для работы ролей и плейбука
- ```main_playbook.yml``` - главный плейбук для запуска ролей

Перед тем как начать работу с проектом необходимо установить зависимости из ```requirements.yml``` с помощью команды:
```
ansible-galaxy install -r requirements.yml --force
```

При тестировании в качестве удаленного хоста испльзовался Debian 13. В качестве локальной OS (откуда производился запуск) - Ubunty 22.04.

## <a name="role_composer"></a>Роль Composer

Данная роль отвечает за установку и настройку Composer. 

Переменные:
- ```composer_php_packages``` - тип list, отвечает за пакеты для установки PHP
- ```composer_install_path``` - тип string, директория установки composer

## <a name="role_mysql"></a>Роль mysql

Данная роль отвечает за установку и настройку MySQL. Для установки подкачивается ```mysql_apt_config``` заданной версии с mysql.com.
В данной роли есть ряд переменных, у которых заданы значения по умолчанию. Возможно изменение при необходимости.

Переменные:
- ```mysql_packages``` - тип list, список mysql пакетов
- ```mysql_root_password``` - тип string, пароль, который устанавливается для пользователя root

## <a name="role_nginx"></a>Роль nginx

Данная роль отвечает за установку Nginx и добавление конфига Nginx. Конфиг по умолчанию задан в ```files``` директории Nginx, при необходимости можно изменить его параметры.

Переменные:
- ```nginx_default_user``` - тип string, пользователь nginx
- ```nginx_default_user``` - тип string, группа пользователя nginx
- ```nginx_conf_user``` - тип string, пользователь для деплоя конфигов
- ```nginx_conf_group``` - тип string, группа для деплоя конфигов
- ```nginx_conf_folder``` - тип string, директория установки nginx

## <a name="role_python"></a>Роль python

Данная роль отвечает за установку и сборку из исходных файлов Python. Для установки подкачивает заданную версию Python, после чего выполняет сборку из исходных файлов.

Переменные:
- ```python_require_pip_deps``` - тип list, список пакетов для установки через pip
- ```python_build_directory``` - тип string, директория распаковки и компиляции исходников
- ```python_path_prefix``` - тип string, директория установки Python

## <a name="role_system"></a>Роль system

Данная роль отвечает за системные настойки (установка необходимых пакетов, управление пользователями и так далее). Выполняется первой в плейбуке, поскольку выполняет первоначально необходимые действия.
Так же данная роль создает и копирует SSH ключи (возможно изменить в ```files```) для заданного пользователя.

Переменные:
- ```system_require_packages``` - тип list, список пакетов для установки 
- ```system_deploy_user``` - тип string, новый пользователь deploy
- ```system_deploy_group``` - тип string, группа пользователя deploy

## <a name="start_role"></a>Запуск ролей и плейбука

Перед запуском необходимо проверить:
1. Что установлены все необходимые элементы Ansible согласно [документации](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html)
2. Задан корректный хост в ```invenotory/```, дополнительно можно обратиться к [документации](https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html)
3. Установить все зависимости из ```requirements.yml```, как это описано в разделе **Структура и описание проекта**.

Для запуска всех ролей, необходимо запустить плейбук:

```
ansible-playbook main_playbook.yml
```

Если в inventory несколько хостов, то необходимо указать на каком запускать

```
ansible-playbook main_playbook.yml -l <hostname>
```
